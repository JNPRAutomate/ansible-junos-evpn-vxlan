/* This block of configuration has been generated by the role overlay-evpn-access for Ansible */

{% if access is defined %}

{% if access.nbr_ae is defined %}
chassis {
    aggregated-devices {
        ethernet {
            device-count {{ access.nbr_ae }};
        }
    }
}
{% endif %}

interfaces {
{% for interface in access.interfaces %}
    {{ interface.name }} {
{% if interface.description is defined %}
        description "to {{ interface.description }}";
{% endif %}
{% if interface.esi is defined %}
        esi {
            {{ interface.esi }};
            all-active;
        }
{% endif %}
{% if interface.mode == 'aggregate' %}
        ether-options {
            802.3ad {{ interface.parent }};
        }
{% elif interface.mode == 'trunk' %}
        unit 0 {
            family ethernet-switching {
                interface-mode {{ interface.mode }};
                vlan {
                    members [{% for vlan in  interface.vlans %} {{ vlan }}{% endfor %}];
                }
            }
        }
{% elif interface.mode == 'access' %}
        unit 0 {
            family ethernet-switching {
                interface-mode {{ interface.mode }};
                vlan {
                    members [{% for vlan in  interface.vlans %} {{ vlan }}{% endfor %}];
                }
            }
        }
{% elif interface.mode == 'normalize' %}
{% for vni_id, vlan_id in  interface.vni_vlans_mapping.iteritems() %}
        flexible-vlan-tagging;
        unit {{ vlan_id }} {
            vlan-id {{ vlan_id }};
        }
{% endfor %}
{% endif %}
{% if interface.lacp_mode is defined %}
        aggregated-ether-options {
            lacp {
                {{ interface.lacp_mode }};
                system-id {{ interface.lacp_system_id }};
            }
        }
{% endif %}
    }
{% endfor %}
}

{% for interface in access.interfaces %}
{% if interface.mode == 'normalize' %}
{% for vni_id, vlan_id in  interface.vni_vlans_mapping.iteritems() %}
vlans {
    bd{{ vni_id }} {
        interface {{ interface.name }}.{{ vlan_id }}
    }
}
{% endfor %}
{% endif %}
{% endfor %}

{% endif %}
